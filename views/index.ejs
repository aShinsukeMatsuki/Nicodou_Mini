<!DOCTYPE html>
<html>
  <head>
    <title>youtube動画をみんなで観てわいわいやるやつ</title>
    <link rel='stylesheet' href='/stylesheets/style.css' />    
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="/javascripts/nicoscreen.js"></script>
    <script>
      $(function(){
      var socket = new io.connect("/");
      
      socket.on("connect", function(){
      $("#transportName").text("ready!:" + socket.socket.transport.name);// 接続時に接続方式表示
      });
      
      socket.on("message", function(message){ //ここで同期
      console.log("message:" + message);
      addComment(message);
      });
 
      socket.on("change", function(message){ //ここで同期
      console.log("change:" + message);
      change(message);
      });
     
      $("#submitButton").click(function(event){
      socket.emit("message", {message: $("#msg").val()});// 入力メッセージをサーバへ
      });

      $("#change").click(function(event){
      socket.emit("change", {message: $("#videoid").val()});// 入力メッセージをサーバへ
      });

      });
    </script>
  </head>
  
  <body>
  　<h1>youtube動画をみんなで観てわいわいやるやつ</h1>
  　ready!になるまでちょっとまってね。
  　<hr>

    <div id="transportName">connecting...</div>
    <input id="msg" size="50"></input>
    <input id="submitButton" type="button" value="submit!"></input><br>
    <input id="videoid" size="50" value="2MJoclZCsbo"></input>
    <input id="change" type="button" value="change"></input>
    <br>
    <div id="nicoscreen" style="width:560px;height:349px"> 
    	 <div id="ytapiplayer">
		You need Flash player 8+ and JavaScript enabled to view this video.
		    </div>
    </div>
    <script type="text/javascript" src="/javascripts/swfobject.js"></script>    
    <script type="text/javascript">
    var params = { allowScriptAccess: "always" };
    var atts = { id: "myytplayer" };
    swfobject.embedSWF("http://www.youtube.com/v/lCuFpAo13uo?enablejsapi=1&playerapiid=ytplayer", 
                       "ytapiplayer", "560", "349", "8", null, null, params, atts);
 
    function onYouTubePlayerReady(playerId) {
      ytplayer = document.getElementById("myytplayer");
    }
 
    function change(message){
        ytplayer.loadVideoById(message, 0 );
    }
  </script>
    
    <script type="text/javascript"> 
 
      var obj = {
      //基本情報が設定できます
      "base":{
      color:"white", //文字の色を指定します
      speed:"slow", //文字が流れるスピードを指定します。slow/fast/normal 
      interval:"normal",//文字が流れる間隔を指定します。slow/fast/normal
      font_size:"30px", //フォントのサイズを指定します。
      loop:false //文字が最後まで流れた後に、繰り返すかどうか　true/false
      },
      "comments":[
      
      ]
      };
      
      nicoscreen.set(obj);
      nicoscreen.start();
      
      function addComment(msg){
      console.log("add!!:" + msg);
      var str = $(msg).val();
      nicoscreen.add(msg);
      $("#msg").val("");
      }
      
    </script>    
  </body>
</html>
